<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>web異世界の旅01：新手村Apache</title><link rel="shortcut icon" href="/images/avatar.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css"><script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script></head><body><div class="profile"><section id="wrapper"><header id="header"><a href="/"><img class="2x" id="avatar" src="/images/avatar.png"></a><h1>xiaoyupang</h1><h2>copy&paste is justice,国服第一复制粘贴手</h2><h1> <a href="https://github.com/XiaoyuPang"> <i class="fa fa-github"></i></a><a href="https://weibo.com/u/6681775699"> <i class="fa fa-weibo"></i></a></h1></header></section></div><section class="post" id="wrapper"><article><header><h1>web異世界の旅01：新手村Apache</h1><h2 class="headline">Feb 18, 2017 2:58·1.6k words
·7 minutes read<span class="tags"></span></h2></header><div id="toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Apache的目录结构"><span class="toc-text">Apache的目录结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置虚拟目录"><span class="toc-text">配置虚拟目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置虚拟主机"><span class="toc-text">配置虚拟主机</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#单IP映射多域名"><span class="toc-text">单IP映射多域名</span></a></li></ol></div><section id="post-body"> <a id="more"></a>
<p> <img src="http://oixwna9a2.bkt.clouddn.com/images/blog/web/01/apache.jpg" alt="" title="(ID: 61606256  画师: なつ)"></p>
<p>所谓web服务器其实就是HTTP Server，Apache是专业的HTTP协议软件，在互联网上负责向客户端请求返回静态文件。了解更多戳这儿<a href="http://baike.baidu.com/link?url=nH7hOEI5jQhNdrE8q5AkYgECZ8NPD6ZaR3ZkzhH12kCpgmBX9U7WmNQKNMvaSqDpajdubh4OCLsymqDegI2HDq" target="_blank" rel="noopener">Apache的百度百科</a>.</p>
<p>环境：<code>Apache2.4</code> <code>win10 x64</code></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>1.到官网下载Apache2.4的压缩包后在本地解压。<br>2.自定义安装路径：<br>    把Apache24文件夹复制到想要安装的路径（比如F盘的website目录<code>F：/website/</code>）然后修改Apache24/conf/httpd.conf文件中<code>Define SRVROOT</code>这一行，把SRVROOT的变量值改为Apache24的存放路径<code>F：/website/Apache24</code></p>
<p>3.添加path环境变量：<br><code>右键计算机-&gt;属性-&gt;高级系统设置-&gt;高级-&gt;环境变量-&gt;path-&gt;编辑</code>添加Apache的bin目录路径<code>F:/website/Apache24/bin</code>。环境变量path可以有多个，每个路径以分号结束，添加环境变量是为了能在操作系统终端执行Apache的指令，Apache指令就存放在bin目录下。</p>
<p>4.安装：<br>    以管理员权限打开PowerShell，输入<code>httpd -k install</code>命令完成安装。<code>ctrl+alt+delete进入任务管理器-&gt;服务—&gt;打开服务</code>就能找到Apache2.4本地服务。其他一些命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">httpd -k stop       //Stop Apache</span><br><span class="line">httpd -k restart    //Restart Apache</span><br><span class="line">httpd -k uninstall  //Uninstall Apache</span><br><span class="line">httpd -V            //Version Details</span><br><span class="line">httpd -t            //Test Config Syntax</span><br><span class="line">httpd -h            //Command Line Options List</span><br></pre></td></tr></table></figure></p>
<pre><code>（Mark：在终端以comment line控制Apache必须是在管理员权限下。）
</code></pre><h1 id="Apache的目录结构"><a href="#Apache的目录结构" class="headerlink" title="Apache的目录结构"></a>Apache的目录结构</h1><p><img src="http://oixwna9a2.bkt.clouddn.com/image/blog/web/01/stru.png" alt=""></p>
<h1 id="配置虚拟目录"><a href="#配置虚拟目录" class="headerlink" title="配置虚拟目录"></a>配置虚拟目录</h1><p>Apache默认的web应用存放路径是htdocs文件夹，路径配置在conf/httpd.conf这个文件中，由DocumentRoot设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">DocumentRoot &quot;$SRVROOT/htdocs&quot;</span><br><span class="line">&lt;Directory &quot;$SRVROOT/htdocs&quot;&gt;</span><br><span class="line">    #</span><br><span class="line">    # Possible values for the Options directive are &quot;None&quot;, &quot;All&quot;,</span><br><span class="line">    # or any combination of:</span><br><span class="line">    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</span><br><span class="line">    #</span><br><span class="line">    # Note that &quot;MultiViews&quot; must be named *explicitly* --- &quot;Options All&quot;</span><br><span class="line">    # doesn&apos;t give it to you.</span><br><span class="line">    #</span><br><span class="line">    # The Options directive is both complicated and important.  Please see</span><br><span class="line">    # http://httpd.apache.org/docs/2.4/mod/core.html#options</span><br><span class="line">    # for more information.</span><br><span class="line">    #</span><br><span class="line">    Options Indexes FollowSymLinks</span><br><span class="line"></span><br><span class="line">    #</span><br><span class="line">    # AllowOverride controls what directives may be placed in .htaccess files.</span><br><span class="line">    # It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:</span><br><span class="line">    #   Options FileInfo AuthConfig Limit</span><br><span class="line">    #</span><br><span class="line">    AllowOverride None</span><br><span class="line"></span><br><span class="line">    #</span><br><span class="line">    # Controls who can get stuff from this server.</span><br><span class="line">    #</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p>
<p>在这里我们把<code>$SRVROOT/htdocs</code>都改成<code>F:/website/blog</code>这样Apache就会把blog文件夹当作是web应用的根目录。<br><code>&lt;Directory&gt;</code>标签用于设置文件的访问权限：<code>AllowOverride None</code>表示设置不允许别人修改我们的页面<code>Require all granted</code>表示设置访问权限为允许。在不同版本的Apache中，设置权限的方式可能不同，如2.2版本中权限的设置是用order allow,deny设置:</p>
<p><img src="http://oixwna9a2.bkt.clouddn.com/image/blog/web/01/access_ctrl.png" alt=""></p>
<p>另外，<code>&lt;IfModule dir_module&gt;</code>标签中的DirectoryIndex设置web应用的首页面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">    DirectoryIndex index.html index.php</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<p>比如我们启动Apache后，在浏览器输入<code>http://localhost</code>,Apache就会在blog下寻找index.html作为返回，如果没有index.html则寻找index.php。<br>（Mark：每次修改httpd.conf文件要重启Apache才能生效）</p>
<h1 id="配置虚拟主机"><a href="#配置虚拟主机" class="headerlink" title="配置虚拟主机"></a>配置虚拟主机</h1><p>一般在要把web应用投如到实际的生产环境的时候才配置虚拟主机，配置步骤：</p>
<p>1.启用httpd-vhosts.conf(在httpd.conf文件中，找到后取消注释即可)</p>
<p>2.在<code>conf/extra/httpd-vhosts.conf</code>文件做配置处理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#配置我们的虚拟主机</span><br><span class="line">&lt;VirtualHost 127.0.0.1:80&gt;</span><br><span class="line">	#站点根目录</span><br><span class="line">	DocumentRoot &quot;F:/website/blog&quot;</span><br><span class="line">	#这里设置欢迎首页面</span><br><span class="line">	DirectoryIndex index.html index.php</span><br><span class="line">	</span><br><span class="line">	&lt;Directory /&gt;</span><br><span class="line">	Options FollowSymLinks</span><br><span class="line">	#不允许别人修改我们的页面</span><br><span class="line">	AllowOverride None</span><br><span class="line">	#设置访问权限</span><br><span class="line">	Require all granted</span><br><span class="line">	&lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></p>
<pre><code>（Mark:配置了虚拟主机后，web应用的目录以虚拟主机配置为主，不再是httpd.conf文件的DocumentRoot）
</code></pre><p>3.修改Host(c:/winwods/systems32的某个路径中)：</p>
<p>我们知道IP地址是分类的，其中127.0.0.1被保留作为本地测试，在浏览器中输入<code>http://localhost</code>其实就是127.0.0.1，如何做到的呢？其实是操作系统的中的hosts文件起到了IP和主机映射关系。当我们在地址栏输入一个域名，浏览器首先做的是浏览本地hosts文件进行DNS解析，如果hosts文件没有存放该域名，就会转发给路由器一级一级的向上查询。<br>win10中的hosts文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Copyright (c) 1993-2009 Microsoft Corp.</span><br><span class="line">#</span><br><span class="line"># This is a sample HOSTS file used by Microsoft TCP/IP for Windows.</span><br><span class="line">#</span><br><span class="line"># This file contains the mappings of IP addresses to host names. Each</span><br><span class="line"># entry should be kept on an individual line. The IP address should</span><br><span class="line"># be placed in the first column followed by the corresponding host name.</span><br><span class="line"># The IP address and the host name should be separated by at least one</span><br><span class="line"># space.</span><br><span class="line">#</span><br><span class="line"># Additionally, comments (such as these) may be inserted on individual</span><br><span class="line"># lines or following the machine name denoted by a &apos;#&apos; symbol.</span><br><span class="line">#</span><br><span class="line"># For example:</span><br><span class="line">#</span><br><span class="line">#      102.54.94.97     rhino.acme.com          # source server</span><br><span class="line">#       38.25.63.10     x.acme.com              # x client host</span><br><span class="line"></span><br><span class="line"># localhost name resolution is handled within DNS itself.</span><br><span class="line">#	127.0.0.1       localhost</span><br><span class="line">#	::1             localhost</span><br></pre></td></tr></table></figure>
<p>我们可以把127.0.0.1映射成weibo，只要修改一下hosts文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   www.weibo.com</span><br></pre></td></tr></table></figure>
<p>在浏览器地址栏输入<a href="http://www.weibo.com就会被映射到`F:/website/blog/`的index.html欢迎界面。在实际的生产环境中IP要配置成你的服务器的真实IP地址。" target="_blank" rel="noopener">www.weibo.com就会被映射到`F:/website/blog/`的index.html欢迎界面。在实际的生产环境中IP要配置成你的服务器的真实IP地址。</a><br>一个IP地址可以映射多个域名，比如现实生活中同一台服务器下可以有多个站点。</p>
<h1 id="单IP映射多域名"><a href="#单IP映射多域名" class="headerlink" title="单IP映射多域名"></a>单IP映射多域名</h1><p>一个IP映射多个域名可以通过设置Apache，区分不同端口来实现区分不同的站点，但这样设置后访问站点要添加端口号，比如访问百度变成了<code>www.baidu.com:81</code>估计用户要炸，因为谁知道你配置的端口号是多少;-(</p>
<p>另外一种解决方案是通过域名不同来实现区分不同站点，配置httpd-vhosts.conf:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#站点1</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    #站点豆瓣目录</span><br><span class="line"> 	DocumentRoot &quot;F:/website/blog1&quot;</span><br><span class="line">    #域名</span><br><span class="line">    ServerName www.douban.com</span><br><span class="line">    #首页</span><br><span class="line">    DirectoryIndex index.html index.php</span><br><span class="line"></span><br><span class="line">    &lt;Directory /&gt;</span><br><span class="line">	Options FollowSymLinks</span><br><span class="line">	#不允许别人修改我们的页面</span><br><span class="line">	AllowOverride None</span><br><span class="line">	#设置访问权限</span><br><span class="line">	Require all granted</span><br><span class="line">	&lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">#站点2</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    #站点知乎目录</span><br><span class="line"> 	DocumentRoot &quot;F:/website/blog2&quot;</span><br><span class="line">    #域名</span><br><span class="line">    ServerName www.zhihu.com</span><br><span class="line">    #首页</span><br><span class="line">    DirectoryIndex index.html index.php</span><br><span class="line"></span><br><span class="line">    &lt;Directory /&gt;</span><br><span class="line">	Options FollowSymLinks</span><br><span class="line">	#不允许别人修改我们的页面</span><br><span class="line">	AllowOverride None</span><br><span class="line">	#设置访问权限</span><br><span class="line">	Require all granted</span><br><span class="line">	&lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<p>同样的，最后一步是修改hosts。</p>
<p>DONE！</p>
<p>参考资料：<br>1.韩顺平PHP从入门到精通视频教程<br>2.Apache2.4参考手册：<a href="https://httpd.apache.org/docs/2.4/zh-cn/" target="_blank" rel="noopener">https://httpd.apache.org/docs/2.4/zh-cn/</a><br>3.Stack Overflow：<a href="http://stackoverflow.com/questions/10925528/invalid-command-order-perhaps-misspelled-or-defined-by-a-module-not-included" target="_blank" rel="noopener">http://stackoverflow.com/questions/10925528/invalid-command-order-perhaps-misspelled-or-defined-by-a-module-not-included</a></p>
</section><nav id="post-nav"><span class="prev"><a href="/2017/02/25/web02/"><span class="arrow">←</span>Newer Posts</a></span><span class="next"><a href="/2016/10/04/hexo-use/">Older Posts<span class="arrow">→</span></a></span></nav></article></section><footer id="footer"><div id="social"><a class="symbol" href="https://github.com/xiaoyupang"></a></div><p class="small">© Copyright forever  &nbsp;<i class="fa fa-heart" aria-hidden="true"> </i></p></footer><script>hljs.initHighlightingOnLoad();</script></body></html>